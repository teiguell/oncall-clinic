<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test Page</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 30px;
      background-color: #f5f7fa;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-top: 0;
    }
    h2 {
      color: #4b5563;
      margin-top: 30px;
    }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background-color: #1d4ed8;
    }
    pre {
      background-color: #f3f4f6;
      padding: 15px;
      border-radius: 4px;
      overflow: auto;
      max-height: 300px;
    }
    .success {
      color: #10b981;
      font-weight: bold;
    }
    .error {
      color: #ef4444;
      font-weight: bold;
    }
    .input-group {
      margin-bottom: 15px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      margin-top: 5px;
    }
    .connection-status {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .connected {
      background-color: #10b981;
    }
    .disconnected {
      background-color: #ef4444;
    }
    .connecting {
      background-color: #f59e0b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WebSocket Test Page</h1>
    <p>This page tests the WebSocket connection for real-time notifications.</p>
    
    <h2>Connection Status</h2>
    <p>
      <span id="connectionIndicator" class="connection-status disconnected"></span>
      <span id="connectionStatus">Disconnected</span>
    </p>
    
    <div>
      <button id="connectBtn">Connect</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>
    
    <h2>Send Message</h2>
    <div class="input-group">
      <label for="messageInput">Message:</label>
      <textarea id="messageInput" rows="3" placeholder='{"type": "test", "message": "Hello WebSocket"}' disabled></textarea>
    </div>
    <button id="sendBtn" disabled>Send Message</button>
    
    <h2>Log</h2>
    <pre id="logOutput">WebSocket log will appear here...</pre>
    
    <script>
      // DOM Elements
      const connectBtn = document.getElementById('connectBtn');
      const disconnectBtn = document.getElementById('disconnectBtn');
      const messageInput = document.getElementById('messageInput');
      const sendBtn = document.getElementById('sendBtn');
      const logOutput = document.getElementById('logOutput');
      const connectionStatus = document.getElementById('connectionStatus');
      const connectionIndicator = document.getElementById('connectionIndicator');
      
      // WebSocket connection
      let socket = null;
      
      // Add log entry
      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        let formattedMessage = `[${timestamp}] ${message}`;
        
        if (type === 'error') {
          formattedMessage = `<span class="error">${formattedMessage}</span>`;
        } else if (type === 'success') {
          formattedMessage = `<span class="success">${formattedMessage}</span>`;
        }
        
        logOutput.innerHTML = formattedMessage + '\n' + logOutput.innerHTML;
      }
      
      // Update connection status UI
      function updateConnectionStatus(status) {
        connectionStatus.textContent = status;
        
        if (status === 'Connected') {
          connectionIndicator.className = 'connection-status connected';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          messageInput.disabled = false;
          sendBtn.disabled = false;
        } else if (status === 'Connecting...') {
          connectionIndicator.className = 'connection-status connecting';
          connectBtn.disabled = true;
          disconnectBtn.disabled = true;
          messageInput.disabled = true;
          sendBtn.disabled = true;
        } else {
          connectionIndicator.className = 'connection-status disconnected';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          messageInput.disabled = true;
          sendBtn.disabled = true;
        }
      }
      
      // Connect to WebSocket
      function connect() {
        if (socket) {
          socket.close();
        }
        
        updateConnectionStatus('Connecting...');
        log('Connecting to WebSocket server...');
        
        // Create WebSocket connection using the correct protocol and path
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws`;
        
        try {
          socket = new WebSocket(wsUrl);
          
          socket.addEventListener('open', () => {
            log('WebSocket connection established!', 'success');
            updateConnectionStatus('Connected');
          });
          
          socket.addEventListener('message', (event) => {
            try {
              const data = JSON.parse(event.data);
              log(`Received: ${JSON.stringify(data, null, 2)}`, 'success');
            } catch (error) {
              log(`Received: ${event.data}`, 'success');
            }
          });
          
          socket.addEventListener('error', (error) => {
            log(`WebSocket error: ${error.message || 'Unknown error'}`, 'error');
          });
          
          socket.addEventListener('close', (event) => {
            log(`WebSocket connection closed. Code: ${event.code}, Reason: ${event.reason || 'No reason provided'}`, event.wasClean ? 'info' : 'error');
            updateConnectionStatus('Disconnected');
            socket = null;
          });
        } catch (error) {
          log(`Failed to create WebSocket connection: ${error.message}`, 'error');
          updateConnectionStatus('Disconnected');
        }
      }
      
      // Disconnect WebSocket
      function disconnect() {
        if (socket) {
          log('Closing WebSocket connection...');
          socket.close();
        }
      }
      
      // Send message through WebSocket
      function sendMessage() {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
          log('WebSocket not connected!', 'error');
          return;
        }
        
        try {
          const message = messageInput.value.trim();
          if (!message) {
            log('Message cannot be empty!', 'error');
            return;
          }
          
          socket.send(message);
          log(`Sent: ${message}`, 'info');
        } catch (error) {
          log(`Failed to send message: ${error.message}`, 'error');
        }
      }
      
      // Event listeners
      connectBtn.addEventListener('click', connect);
      disconnectBtn.addEventListener('click', disconnect);
      sendBtn.addEventListener('click', sendMessage);
      
      // Initialize connection status
      updateConnectionStatus('Disconnected');
      log('WebSocket test initialized. Click "Connect" to start.', 'info');
    </script>
  </div>
</body>
</html>